大家好,我是芬哥。上节课我讲了怎么样建立一个简单的Telegram的回生机器人,也就是说你发什么东西给他,他就发还什么东西给你。今天我们来进阶一下这个课程,当我们发送指定命令到机器人的时候,机器人可以做出相应的回应。

我们发送不同的命令给机器人,机器人发回来的东西应该是不一样的。就像你发送一个help给机器人的时候,机器人应该回复你一个关于怎么样使用机器人的一个帮助文档。那你发送其他命令的时候,机器人就应该发送相应的文档回来。好,那我们就开始今天的教程吧。

我们回到Telegram机器人这里,我们输入血干的时候,它会弹出来一个命令,而且这个命令什么也不会做。所以我们现在需要多加几个命令,然后再给这几个命令指定不同的内容。我们在搜索然后输入boat,然后选择boat father,然后在这个地方输入myboat,然后选择我们现在要编辑的机器人,选择editboat,选择editcommands。所以我们现在给它加两个命令,我们这边重新输入命令的时候会把之前我们输入过的命令给覆盖掉,所以我们要全部重新输入过。所以这个help给它一个新的定义,然后我们按Ctrl Enter 来到下一行,现在我们输入另外一个新的命令是colors,然后这个命令就是列出机器人知道的所有颜色,然后我们点回车,然后成功了。

现在,我们回到这个现在,我们回到我们的ThemeTestBot2,这个时候我们如果输入输入斜干它还没有更新,我们随便输入一句话,再输入斜干,好,这个时候就更新出来了。所以你可以看到HELP是我知道很多颜色,请输入Colors查询,Colors是列出他知道的所有颜色。那我们现在输入HELP,它肯定就是跟之前一模一样,因为我们还没有写代码去做任何的改变,所以说它还是跟之前一样是一个回生机器人,我说什么他就说什么。那我们现在去我们的代码部分。

好,这是我们赛杰克讲到的代码,然后如果你找不到链接的话也是script.google.com,然后你可以找到你自己创建的这个谷歌的项目,然后这个代码就是我们之前所说的回声的代码,就是你说什么他就说什么。现在我们做一些小小的改变,让它来处理相对不同的命令。所有的文字命令是在这一块被处理的,在这个地方我们只要去查看这个文字的内容是什么,我们去判断不同的内容给出不同的答案,那么我们这个机器人就可以处理不同的命令了。

因为我们刚才加入了一个help命令和一个colors命令,所以我们现在就来对这两个命令做不同的回复。所以这个地方我们来写一段code,你可以写if,我们写if,好,我现在这边加了一段代码,那就是我去确认这个text的内容,如果这个内容是等于help的时候,那么它返回的是这样一个payload,而这两个东西我们并没有改变它是一样的,我们只是改变了这个text的内容,原来只是返回我们收到的text的内容,那现在我们返回的是这样的一句话。所以我们现在来试一下,我们现在点击保存,然后点击发布,然后部署为网络应用,这个时候项目版本从1我们把它改成一个新键,这个时候点更新,然后点确定,好,这样我们的机器人的新的代码就已经被发布了。那我们现在再来试一下我们的机器人,好,回到机器人的地方,我们输入票,好,你看他回来了我们刚才在代码里面写的东西,你好欢迎使用本机器人,本机器人现在责任是颜色,好,这就是他处理的 help 命令。那我们现在把同样的代码我们复制一下,那这个地方我们可以输入,我们刚才下一个命令是 colors,colors,那我们在收到colors这个命令的时候我们就要列出颜色,所以他可能知道了一些颜色,我们可以输入我们所知道的颜色红黄蓝,然后我们把它保存,然后这个时候同样的我们要发布一下不属于网络应用,然后这时候把项目改版本改成新键更新,然后点确定,好,这样呢我们这样一个新的命令又被完成了,我回到机器人去看一下,我们现在加了一条新的命令叫Colors,然后我们现在回车来看到机器人回来了红黄蓝,你看是不是非常简单写一个机器人,我们只是做一个简单的判断,然后回复不同的内容回来,那么这机器人就好像可以处理不同的命令了。

那这边我们的判断是一个简单的等于好的判断,也就是说如果用户输入了多余的制服他可能就不工作了,我们现在来试一下,我们输入help后面加了一些空格,我们再回车发现它还是一样工作的,也就是说这个空格可以被正常的处理,那我们来试一下前面放空格的情况,前面被放空格的情况也会被自然的处理,那是因为我们在输入这个文字的时候我们的客户端已经把这个空格前后的空格已经被拉给trim掉了,所以这个时候它还会正常的工作,但是有一种情况它就不会工作了,比如说这个机器是在群里面的时候,我们现在讲一下怎么样把这个机器人交到群里面,点击一下这个机器人的标题,然后在底下你会看到一个Add to Group,点一下然后把它加到我的群里面,问你要不要加到这个群里面,OK,好,我现在已经把这个Bot加到这个群里面,这是我原来的机器人,我原来的机器人欢迎这个新的机器人加入,这是另外一个机器人,所以不要混淆这个是我们现在正在写的机器人,那现在就是有一个问题,我们现在有两个的机器人,所以我们发一个Help 消息的时候到底是发给机器人A呢还是发给机器人B呢,所以这个时候我们就要告诉机器人我这句话是发给谁的,我们同样输入Help,你发现当你输入这个命令的时候它会弹出选项,你可以选择第一个机器人然后或者选择第二个机器人,那我们现在选择第一个机器人,我们选择这个我们刚才做的新的机器,我们点一下OK,然后发现它发送的是这样一个消息出去,它已经不是发单纯的help message,它后面有一个at,然后这个情况下我们没办法判断它是一个正常的help message,同样的如果我们输入color的话,我们color以后我们直接按tap去完成这个命令的补充回车,他没有办法知道这个命令是一个Colors的命令,他就把它当做其他普通的命令的补充,然后回车,那么他也是,他没有办法知道这个命令是一个Colors的命令,他就把它当做其他普通的命令,那他就回到了之前回升机器人的本色,你发什么东西给他,他发什么东西还给你了,那所以我们现在需要做一些简单的改变,回到我们代码,我们可以看到我们之前在check一个text的时候,我们是用等号来做的,如果我们想说我们只在意这个字符里面有没有slash help 这几个字,而不管它后面跟着是什么东西的话,我们可以这样做,我现在把这个等式做了一些改变,我们这个时候我们是去 check,如果这个 text是以这五个字母开头的话,那我们就会trigger这条Message,也就是说我们并不在乎后面跟着什么内容,只要它最前面五个字符是这个字符,那我们就会判断为是这个内容,我们现在把它保存一下,点发布,点部署为网络应用,这时候我们把项目版本改成新建,点更新,点确定,好的,那现在我们的机器人应该已经有不同的表现,我们现在去机器人那边看一看,回到我们的机器人,这个时候我们同样的,我们输入help,到时候我后面跟着一大堆的add的内容,我们回车,好,你看,你好欢迎使用本机器人,本机器人现在只能是颜色,也就是说我们现在我们的 help 命令已经被识别出来了,这时候我们输入 colors 呢是肯定还没有效果,因为 colors 还没有变,那我们回到代码,在代码这个地方,我们做同样的改变,所以我们把这一段复制粘贴到这个位置,然后把这边改成Colors,然后我们保存,也不足为网络应用新建,然后更新,确定,回到我们的机器人,我们输入Colors,刚才没有工作,因为这边少了一个点,我们把点加回去,然后我们重新发布一遍,点更新,因为这是一个网页版的编辑器,所以有时候它的实错功能不是很强大,所以说写代码的时候要非常的小心,像刚才一样我漏掉了一个点,那么它就不工作了,所以说如果你只要写错一点点你的机器人就会废掉,那以后我会跟大家讲一下怎样测试你的机器人,那现在呢我们先就直接发布,好,我们修复了刚才的问题,我们现在重新来一次,好,红环蓝就出来了,那这样就可以,即使是后面凳子一些乱七八糟的制服,我们也同样可以判断我们的证据的命令,当然我们可以跟着一些其他的内容,我们可以说HELP,然后跟任何东西其实都可以,因为这个时候我们的机器人并不会在乎后面跟着是什么内容,他一样会打出正确的回复,当然了,我们有时候我们想回来的是一个比较复杂的文本,那可能会有很多的回车,那我现在怎样怎么样在我们的文本里面加回车,回到我们的脚本,然后我们这个时候我们说我想把红环栏放在不同的行,所以我们跟着一个斜杠N,所以我们用斜杠N代替了原来的逗号,那么这个时候红环栏就会出现在不同的行中,我们可以现在点击保存,然后发布,项目版本新建,更新,然后点确定,现在我们回到我们的机器人,这个时候我们如果输入colors,看到这个文字就变成了红黄蓝,但是红黄蓝在不同的行,所以我们可以回复一些比较复杂的文本文字或者是一个段落,这样子呢这个机器人的用处就变得比较大了,你也可以用机器人返回一些HTML的链接,这样子的话机器人会自动把这些链接变成可电机的链接,不是我这个机器人,这个聊天Telegram会自动去render这些链接,这些东西,那我们再回到代码,我们稍微优化一下这个代码,这个代码有什么问题呢,就是我们其实在这个地方我们去重复了这个这个内容,因为你会有很多的if,所以呢你会有很多这个同样的内容,我们其实不需要去重复这个内容,我们可以把这个内容冒到外面,我们把这个内容放在外面,那么它就是作为一个默认的设置,那我们在不同if的时候呢,我们可以去改变这个text的值,所以我们可以在这个地方我们可以这样做,就是我们在确认这个 meaning是help meaning的时候,我们把这个text改掉,这两个东西我们保留不动,同样的道理,我们可以在这个地方把这句话复制到这里,那这个样子呢就是我们就省略掉了这个重复的这两个东西,所以呢你会看到我们的代码会简化很多,如果你是有很多的衣服的话,你的代码就不会有这么多重复的这两个东西,当然这个代码是还可以优化的,因为我们可以用一个switch来做,就不会有这么多的if,那这样我没有必要讲那么复杂,因为我们只是需要它工作,那这样的代码已经可以很好的工作了,那我们会在以后的课程中会用一些更高效更优化的代码,那我们现在才第二节课,所以我们把它尽量重减,好,我们现在来试一下,我们把它保存,然后发布一下,我们在这个机器人的手机上输入,我们在这个机器人的手机上输入,我们在这个机器人的手机上输入,我们在这个机器人的手机上输入,我们在这个机器人的手机上输入,回到我们的机器人,我们输入 help,同样的它还是工作的,同样的它还是工作的,同样的它还是工作的,然后我们再输入 colors,同样的它也还是工作的,同样的它也还是工作的,同样的它也还是工作的,同样的,它也还是工作的,所以我们刚才的代码做了一些小小的改变,但是它还是工作的,但是这个代码比原来的代码会比较优化一些,那好,我们今天的教程就到这里,下节课我们会讲一讲怎样去处理代参数的命令,就是说一个命令我们可以跟着不同的参数,那么通过不同的参数我们返回来不同的内容,比如说我们有一个命令是查询某个人的信息,我们可以比如说find或者look search无所谓命令叫什么,你可以就是说search然后某个人,某个人search邓子齐,然后他就回来所有关于邓子齐的信息,可以这样子对不对,所以说我们不需要写很多的命令去给回来不同的信息,我们可以用同样一个命令但是用不同的参数他就回来不同的信息,那下期课我们不见不上,拜拜,哦,差点忘了,如果喜欢我的视频的话,请帮我点个赞,然后订阅一下我的频道,好,这次是真的拜拜了,拜拜,相关的下载你们可以直接到图片上这个网址去下载,好,今天的教程就到这里,谢谢大家观看,请大家多多点赞多多订阅,拜拜。